export RAILS_ENV="${MAPWARPER_RAILS_ENV}"
export RACK_ENV="${MAPWARPER_RAILS_ENV}"
export SECRET_KEY_BASE="${MAPWARPER_SECRET_KEY_BASE}"
export REDIS_URL="${MAPWARPER_REDIS_URL}"
export BUNDLE_APP_CONFIG="/app/.bundle"
export DATABASE_CLEANER_ALLOW_REMOTE_DATABASE_URL=true
export MAGICK_MEMORY_LIMIT="${MAPWARPER_MAGICK_MEMORY_LIMIT}"
export MAGICK_MAP_LIMIT="${MAPWARPER_MAGICK_MAP_LIMIT}"
export LISTEN_PORT="${MAPWARPER_INTERNAL_PORT}"
export RAILS_ROOT="/app"

# these values were in the mapwarper-app-config ConfigMap in the original mw k8s setup:
export DB_HOST="${MAPWARPER_DB_HOST}"
export MAGICK_MEMORY_LIMIT="${MAPWARPER_MAGICK_MEMORY_LIMIT}"
export MAGICK_MAP_LIMIT="${MAPWARPER_MAGICK_MAP_LIMIT}"
export MW_CDN_TILES_HOST=""
export MW_DEBUG_K8S="true"
export MW_DST_MAPS_DIR="/mnt/mapwarper/maps/dst/"
export MW_EMAIL="k8sexample2@example.com"
export MW_ENABLE_OCR_JOB="false"
export MW_ENABLE_THROTTLING="false"
export MW_FORCE_SSL=""
export MW_GDAL_PATH=""
export MW_GOOGLE_JSON_KEY_LOCATION="/mapwarper-sa-key.json"
export MW_GOOGLE_MAPS_KEY=""
export MW_GOOGLE_STORAGE_BUCKET="${MAPWARPER_WARPER_BUCKET}"
export MW_GOOGLE_STORAGE_ENABLED="true"
export MW_GOOGLE_STORAGE_PROJECT="${GCP_PROJECT_ID}"
export MW_GOOGLE_TILES_BUCKET="${MAPWARPER_TILES_BUCKET}"
export MW_HOST=""
export MW_HOST_WITH_SCHEME=""
export MW_MAPBOX_ACCESS_TOKEN=""
export MW_MAP_MASK_DIR="/mnt/mapwarper/maps/masks"
export MW_NYPL_REPO_TOKEN=""
export MW_OCR_BUCKET=""
export MW_OMNIAUTH_GOOGLE_KEY=""
export MW_OMNIAUTH_GOOGLE_SECRET=""
export MW_PUBLIC_SHARED_DIR="shared"
export MW_REPLY_TO=""
export MW_SENDGRID_API_KEY=""
export MW_SRC_MAPS_DIR="/mnt/mapwarper/maps/src/"
export MW_THROTTLE_LIMIT="30"
export MW_THROTTLE_PERIOD="60"
export MW_TILEINDEX_DIR="/mnt/mapwarper/maps/tileindex"
export REDIS_URL="${MAPWARPER_REDIS_URL}"

# these values were in the mapwarper-secrets Secret in the original mw k8s setup:
export DB_USER="${MAPWARPER_DB_USER}"
export DB_PASSWORD="${MAPWARPER_DB_PASSWORD}"
export DB_NAME="${MAPWARPER_DB_NAME}"
export SECRET_KEY_BASE="${MAPWARPER_SECRET_KEY_BASE}"

# these were hardcoded in mapwarper_deployment.yaml in the original mw k8s setup:
export RAILS_ENV="${MAPWARPER_RAILS_ENV}"
export RACK_ENV="${MAPWARPER_RAILS_ENV}"
export RAILS_SERVE_STATIC_FILES="true"

cd /app

bundle exec rails s -p ${MAPWARPER_INTERNAL_PORT} -b "0.0.0.0"
